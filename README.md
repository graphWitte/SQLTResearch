# Лабораторная работа №1
## Прокат автомобилей. (вариант 22)
Фирма выдает напрокат автомобили. Информация об автомобиле (модель,
цвет, год выпуска, госномер, стоимость одного дня проката). Информация о
клиенте (ФИО, серия и номер паспорта). Накапливается информация о
прокатах, где накапливается информация о дате начала проката и количестве
дней проката. Стоимость одного дня проката может отличаться для разных
автомобилей.
Выходные документы.
 - Список прокатных документов за определенный период с указанием
стоимости проката и страхового взноса. Стоимость проката автомобиля
определяется как Стоимость одного дня проката · Количество дней
проката. Фирма ежегодно страхует автомобили, выдаваемые клиентам.
Страховой взнос, выплачиваемый фирмой, равен 10 процентам от
страховой стоимости автомобиля.
 - Список автомобилей, упорядоченный по моделям, а для каждой модели
 по убыванию года выпуска.
### ER-диаграмма (рис. 1)
![ER-диаграмма](jpges/ERdiagram.PNG)

# Лабораторная работа №2
## Логическая модель
 ### Сущность Clients
- Назначение: хранение информации о клиентах
- атрибуты:
- - id - уникальный идентификатор клиента
- - full_name - ФИО
- - passport - паспортные данные
 ### Сущность Cars
- Назначение: хранение информации об автомобилях
- Атрибуты:
- - id - уникальный идентификатор автомбиля
- - model - модель
- - color - цвет
- - year - год выпуска
- - license_plate - гос. номер
- - current_daily_price - цена за день аренды
### Сущность Rentals
- Назначение: хранение информации о прокатах
- Атрибуты:
- - id - Уникальный идентификатор проката
- - client_id - ссылка на клиента
- - car_id — ссылка на автомобиль
- - start_date — дата начала проката
- - days_count — количество дней
- - price_at_rental - зафиксированная стоимость одного дня проката на момент оформления (для истории)
### Сущность Insurances
- Назначение: хранение информации о страховании автомобилей.
- Атрибуты:
- - id — уникальный идентификатор записи
- - car_id — ссылка на автомобиль
- - insurance_value — страховая стоимость автомобиля
- - insurance_year — год страхования
## Физическая модель
![Физическая модель](jpges/fizmod.png)
## DDL Запросы
### Создаем таблицы
![Orders](jpges/soz1.png)
### Заполняем таблицы
![Заполняем](jpges/zaptab.png)
## SELECT запросы
Список прокатов с расчетами (страховой взнос 10% от оценочной стоимости авто)
![Прокаты и расчеты](jpges/select1.png)
Список автомобилей и сортировка (А-Я + от новых к старым)
![Список](jpges/select2.png)
# Лабораторная работа 3
## Создание представлений
### Представление для отчета по прокатам
![..](jpges/lab3.1.png)
проверяем
![Прокаты и расчеты](jpges/lab3.2.png)
### Представление для списка авто
![Прокаты и расчеты](jpges/lab3.3.png)
проверяем
![Прокаты и расчеты](jpges/lab3.4.png)
## Процедуры
### Оформление проката
![Прокаты и расчеты](jpges/lab3.5.png)
проверяем, сдаем машину №1 клиенту №2 на 5 дней
![Прокаты и расчеты](jpges/lab3.6.png)
![Прокаты и расчеты](jpges/lab3.7.png)
### Изменение цены авто
![Прокаты и расчеты](jpges/lab3.8.png)
меняем стоимость машины 1 на 9999 рублей
![Прокаты и расчеты](jpges/lab3.9.png)
![Прокаты и расчеты](jpges/lab3.10.png)
# Лабораторная работа 4
## Создаю генераторы, которые заполнят таблицы
### Генератор данных

` ```sql `
-- 1. Очистка таблиц и сброс счетчиков
TRUNCATE TABLE radaev_2262.Rentals, radaev_2262.Insurances, radaev_2262.Cars, radaev_2262.Clients RESTART IDENTITY CASCADE;

-- 2. Генерация Клиентов (Реальные ФИО и формат паспорта)
INSERT INTO radaev_2262.Clients (full_name, passport)
SELECT 
    (ARRAY['Иванов', 'Смирнов', 'Кузнецов', 'Попов', 'Васильев', 'Петров', 'Соколов', 'Михайлов', 'Новиков', 'Федоров'])[floor(random() * 10 + 1)]
    || ' ' ||
    (ARRAY['Александр', 'Сергей', 'Дмитрий', 'Андрей', 'Алексей', 'Максим', 'Евгений', 'Иван', 'Михаил', 'Артем'])[floor(random() * 10 + 1)]
    || ' ' ||
    (ARRAY['Иванович', 'Петрович', 'Сергеевич', 'Андреевич', 'Алексеевич', 'Александрович', 'Дмитриевич', 'Максимович', 'Михайлович', 'Владимирович'])[floor(random() * 10 + 1)],
    
    (10 + floor(random() * 90))::TEXT || ' ' || 
    (10 + floor(random() * 90))::TEXT || ' ' || 
    (100000 + floor(random() * 900000))::TEXT
FROM generate_series(1, 20000);

-- 3. Генерация Автомобилей (Реальные бренды и госномера)
INSERT INTO radaev_2262.Cars (model, color, year, license_plate, current_daily_price)
SELECT 
    (ARRAY['Toyota Camry', 'Kia Rio', 'Hyundai Solaris', 'BMW X5', 'Lada Vesta', 'Skoda Octavia', 'Volkswagen Polo', 'Renault Logan', 'Mazda 6', 'Ford Focus'])[floor(random() * 10 + 1)],
    (ARRAY['Черный', 'Белый', 'Серебристый', 'Синий', 'Красный', 'Серый', 'Зеленый', 'Бежевый'])[floor(random() * 8 + 1)],
    2015 + floor(random() * 9)::INT,
    (ARRAY['А', 'В', 'Е', 'К', 'М', 'Н', 'О', 'Р', 'С', 'Т', 'У', 'Х'])[floor(random() * 12 + 1)] || 
    (100 + floor(random() * 899))::TEXT || 
    (ARRAY['А', 'В', 'Е', 'К', 'М', 'Н', 'О', 'Р', 'С', 'Т', 'У', 'Х'])[floor(random() * 12 + 1)] ||
    (ARRAY['А', 'В', 'Е', 'К', 'М', 'Н', 'О', 'Р', 'С', 'Т', 'У', 'Х'])[floor(random() * 12 + 1)] || 
    '777',
    (floor(random() * 50) + 15) * 100
FROM generate_series(1, 20000) AS i;

-- 4. Генерация Прокатов (50 000 записей)
INSERT INTO radaev_2262.Rentals (client_id, car_id, start_date, days_count, price_at_rental)
SELECT 
    (floor(random() * 20000) + 1)::INT,
    (floor(random() * 20000) + 1)::INT,
    '2023-01-01'::DATE + (floor(random() * 365))::INT,
    (floor(random() * 14) + 1)::INT,
    2000.00 + (floor(random() * 30) * 100)
FROM generate_series(1, 50000) AS s;
` ``` `



